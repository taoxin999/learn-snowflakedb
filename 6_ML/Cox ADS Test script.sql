use schema DT_SOFTWARE_ENGINEERING_DEV.RDIM;
select * from DIM_DEALER_S3;

show primary keys in DIM_CUSTOMER;
SHOW PRIMARY KEYS
    [ IN { ACCOUNT | DATABASE [ DT_SOFTWARE_ENGINEERING_DEV ] | SCHEMA [ RDIM ] | TABLE | [ TABLE ] DIM_CUSTOMER } ] ;
truncate table DIM_CUSTOMER;

delete from DIM_CUSTOMER_S3 
where DLR_CD = 1089761 AND SOURCESYSTEM = 'DT2'
AND CC_ID=113262028505511000 and UPPER_FRST_NM='TRUMP';

SELECT *
--DLR_CD.CC_ID,UPPER_FRST_NM
FROM DIM_CUSTOMER --_S3 
WHERE DLR_CD=1089761 AND SOURCESYSTEM= 'DT2'
    AND CC_ID=113262028505511000;
    
SELECT DLR_CD, DEALERID, SOURCESYSTEM, CC_ID,count(*)
  FROM DIM_CUSTOMER 
 WHERE DLR_CD=1089761 AND SOURCESYSTEM= 'DT2'
    AND CC_ID=113262028505511000
group by DLR_CD, DEALERID, SOURCESYSTEM, CC_ID;

UPDATE DIM_CUSTOMER_S3
   SET UPPER_FRST_NM = 'Tao'
WHERE DLR_CD=1089761
    AND SOURCESYSTEM= 'DT2'
    AND CC_ID=113262028505511000;


UPDATE DIM_CUSTOMER_S3 
   SET UPPER_FRST_NM = 'TRUMP'
WHERE DLR_CD=1089761 AND SOURCESYSTEM= 'DT2'
AND CC_ID = 113262028505511000 and UPPER_FRST_NM ='Trump';


UPDATE DIM_CUSTOMER_S3 
   SET UPPER_FRST_NM = 'TRUMP'
WHERE DLR_CD=1089761 AND SOURCESYSTEM= 'DT2'
AND CC_ID = 113262028505511000 and UPPER_FRST_NM ='BIDEN';

UPDATE DIM_CUSTOMER_S3 
SET UPPER_FRST_NM = 'SMITHONE'
WHERE DLR_CD=1089761 AND SOURCESYSTEM= 'DT2'
AND CC_ID = 113262028505511000;


SELECT COUNT(1) FROM DIM_CUSTOMER_STREAM;
SELECT COUNT(*) FROM DIM_CUSTOMER_STREAM_APPEND_ONLY;

SELECT * FROM DIM_CUSTOMER_STREAM;
SELECT DLR_CD, CC_ID, UPPER_FRST_NM, UPPER_LAST_NM, METADATA$ACTION, METADATA$ISUPDATE, ETS_CREATED_TS,ETS_UPDATED_TS 
FROM DIM_CUSTOMER_STREAM;

-- --IF WE ADD THE CONDITIO IN THE STREAM NOT TO SELECT THE DELETE
-- 2024-01-23 13:28:49.721 2024-01-23 13:36:31.561
-- 2024-01-23 13:39:52.304

SELECT * FROM DIM_CUSTOMER_STREAM_APPEND_ONLY;

SELECT * FROM DIM_CUSTOMER_S3;
SELECT COUNT (*) FROM DIM_CUSTOMER_S3; 
--215025

update DIM_CUSTOMER_S3; 
set op='I';


SELECT COUNT(*) FROM DIM_CUSTOMER;
-- 215025
SELECT COUNT(*) FROM DIM_CUSTOMER_STREAM 
WHERE NOT (METADATA$ACTION = 'DELETE' AND METADATA$ISUPDATE = TRUE);

truncate table DIM_CUSTOMER;

